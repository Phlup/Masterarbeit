matrix(data = c(1,2,3,4,5,6), nrow = 2) -> Y
d <- Y %*% t(Y)
vec <- sqrt(diag(d))
d <- d/vec[col(d)]
d <- d/vec[row(d)]
d <- -log(d)
d <- as.dist(d)
d
matrix(data = c(1,2,3,4,5,6), ncol = 2) -> Y
Y
d <- Y %*% t(Y)
vec <- sqrt(diag(d))
d <- d/vec[col(d)]
d <- d/vec[row(d)]
d <- -log(d)
d <- as.dist(d)
d
d <- Y %*% t(Y)
vec <- sqrt(diag(d))
d <- d/vec[col(d)]
d <- d/vec[row(d)]
d <- -log(d)
d
matrix(data = c(1,2,3,4,5,6), nrow = 2) -> Y
d <- Y %*% t(Y)
vec <- sqrt(diag(d))
d <- d/vec[col(d)]
d <- d/vec[row(d)]
d <- -log(d)
d
?log
library(openxlsx)
library(data.table)
#calculate recombination rates (cM/Mb) for Maize NAM population (B73)
#read in cM and chr SNP data
NAM_map <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_map_20080419_xlsx.xlsx")
#SNP_pos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_1144SNPs_AGPv2_positions.xlsx")
SNP_pos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_1144SNPs_AGPv1_positions.xlsx")
SNP_pos <- SNP_pos[!((SNP_pos$Position == "NULL") | (SNP_pos$Position == "multiple")),]
#SNP_pos <- SNP_pos[SNP_pos$AGPv2_pos != "unknown",]
#merge on SNP id
gen_map <- merge(NAM_map[,c("marker", "ch", "cumulative")],
SNP_pos[,c("Marker", "Position")], by.x = "marker", by.y = "Marker")
gen_map$Position <- as.numeric(gen_map$Position)
#sort by chr then position
gen_map <- gen_map[order(gen_map$ch, gen_map$Position),]
gen_map <- data.table(gen_map)
gen_map[, order := ((shift(cumulative, n = -1) - cumulative) >= 0), by = ch]
#manually remove "misplaced SNPs"
gen_map <- gen_map[!(marker %in% c("PZA01072.1", "PZA00545.26", "PZA00963.3", "PZA01960.1",
"zb7.2", "PHM1184.26", "PHM2438.28", "PZA03227.1"))]
#remove SNPs where cumulative cM order != SNP position order
gen_map <- gen_map[order == TRUE]
#(i+1-i)/(j+1-j) where i is cM and j is bP, transform to Mb, group by chr
gen_map[, pos_diff := (shift(Position, n = -1) - Position), by = ch]
gen_map[, cM_diff := (shift(cumulative, n = -1) - cumulative), by = ch]
gen_map[, rate := cM_diff/(pos_diff/1000000)]
#impute rates for last SNPs per chr
gen_map[,rate := replace(rate, is.na(rate), median(rate, na.rm = TRUE)), by = ch]
gen_map <- gen_map[,c("ch", "Position", "rate", "cumulative")]
colnames(gen_map) <- c("Chromosome", "Position(bp)", "Rate(cM/Mb)", "Map(cM)")
gen_map$Chromosome <- as.character(gen_map$Chromosome)
View(gen_map)
gen_map$Chromosome <- paste("chr", gen_map$Chromosome, collapse = "")
#calculate recombination rates (cM/Mb) for Maize NAM population (B73)
#read in cM and chr SNP data
NAM_map <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_map_20080419_xlsx.xlsx")
#SNP_pos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_1144SNPs_AGPv2_positions.xlsx")
SNP_pos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_1144SNPs_AGPv1_positions.xlsx")
SNP_pos <- SNP_pos[!((SNP_pos$Position == "NULL") | (SNP_pos$Position == "multiple")),]
#SNP_pos <- SNP_pos[SNP_pos$AGPv2_pos != "unknown",]
#merge on SNP id
gen_map <- merge(NAM_map[,c("marker", "ch", "cumulative")],
SNP_pos[,c("Marker", "Position")], by.x = "marker", by.y = "Marker")
gen_map$Position <- as.numeric(gen_map$Position)
#sort by chr then position
gen_map <- gen_map[order(gen_map$ch, gen_map$Position),]
gen_map <- data.table(gen_map)
gen_map[, order := ((shift(cumulative, n = -1) - cumulative) >= 0), by = ch]
#manually remove "misplaced SNPs"
gen_map <- gen_map[!(marker %in% c("PZA01072.1", "PZA00545.26", "PZA00963.3", "PZA01960.1",
"zb7.2", "PHM1184.26", "PHM2438.28", "PZA03227.1"))]
#remove SNPs where cumulative cM order != SNP position order
gen_map <- gen_map[order == TRUE]
#(i+1-i)/(j+1-j) where i is cM and j is bP, transform to Mb, group by chr
gen_map[, pos_diff := (shift(Position, n = -1) - Position), by = ch]
gen_map[, cM_diff := (shift(cumulative, n = -1) - cumulative), by = ch]
gen_map[, rate := cM_diff/(pos_diff/1000000)]
#impute rates for last SNPs per chr
gen_map[,rate := replace(rate, is.na(rate), median(rate, na.rm = TRUE)), by = ch]
gen_map <- gen_map[,c("ch", "Position", "rate", "cumulative")]
colnames(gen_map) <- c("Chromosome", "Position(bp)", "Rate(cM/Mb)", "Map(cM)")
gen_map$Chromosome <- as.character(gen_map$Chromosome)
?paste
gen_map$Chromosome
gen_map[,c("Chromosome")]
paste(gen_map[,c("Chromosome")], "a", collapse = "")
gen_map$Chromosome
?paste0
paste0("chr", gen_map$Chromosome, sep = "")
gen_map$Chromosome <- paste("chr", gen_map$Chromosome, sep = "")
#save chr1 and complete set
B73_genmap_chr1 <- gen_map[Chromosome == "chr1"]
B73_genmap <- gen_map
write.csv(genmap_chr1, "../data/test_data/B73_genmap_chr1.csv", row.names = FALSE)
#save chr1 and complete set
genmap_chr1 <- gen_map[Chromosome == "chr1"]
write.csv(genmap_chr1, "../data/test_data/B73_genmap_chr1.csv", row.names = FALSE)
write.csv(gen_map, "../data/test_data/B73_genmap.csv", row.names = FALSE)
library(openxlsx)
#genotpyes
#turn A/A encoding to 0,1,2 of nam snp genos raw
NAM_genos <- read.table("../data/NAM_map_and_genos-121025/NAM_SNP_genos_raw_20090921.txt", header = TRUE,
row.names = 1)
#only parent genos
NAM_genos <- NAM_genos[,c(1:27)]
#B73 allele
B73_allele <- data.table("SNP" = row.names(NAM_genos), "B73" = substring(NAM_genos[,1], 1, 1))
View(B73_allele)
#merge on SNP id
gen_map <- merge(NAM_map[,c("marker", "ch", "cumulative")],
SNP_pos[,c("Marker", "Position")], by.x = "marker", by.y = "Marker")
gen_map$Position <- as.numeric(gen_map$Position)
#sort by chr then position
gen_map <- gen_map[order(gen_map$ch, gen_map$Position),]
gen_map <- data.table(gen_map)
gen_map[, order := ((shift(cumulative, n = -1) - cumulative) >= 0), by = ch]
#manually remove "misplaced SNPs"
gen_map <- gen_map[!(marker %in% c("PZA01072.1", "PZA00545.26", "PZA00963.3", "PZA01960.1",
"zb7.2", "PHM1184.26", "PHM2438.28", "PZA03227.1"))]
#remove SNPs where cumulative cM order != SNP position order
gen_map <- gen_map[order == TRUE]
#(i+1-i)/(j+1-j) where i is cM and j is Mb, transform to Mb, group by chr
gen_map[, pos_diff := (shift(Position, n = -1) - Position), by = ch]
gen_map[, cM_diff := (shift(cumulative, n = -1) - cumulative), by = ch]
gen_map[, rate := cM_diff/(pos_diff/1000000)]
#impute rates for last SNPs per chr
gen_map[,rate := replace(rate, is.na(rate), median(rate, na.rm = TRUE)), by = ch]
table(gen_map$marker %in% B73_allele$SNP)
write.csv(B73_allele, "../data/test_data/B73_alleles.csv", row.names = FALSE)
View(B73_allele)
SNP_pos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_1144SNPs_AGPv1_positions.xlsx")
SNP_pos <- SNP_pos[!((SNP_pos$Position == "NULL") | (SNP_pos$Position == "multiple")),]
View(NAM_map)
View(SNP_pos)
View(gen_map)
View(B73_genmap)
#save SNP positions
SNP_pos <- SNP_pos[,c("Marker", "Chr", "Position")]
View(SNP_pos)
colnames(SNP_pos) <- c("Marker", "Chromosome", "Position(bp)")
#merge on SNP id
gen_map <- merge(NAM_map[,c("marker", "ch", "cumulative")],
SNP_pos[,c("Marker", "Position(bp)")], by.x = "marker", by.y = "Marker")
write.csv(SNP_pos, "NAM_SNP_positions.csv", row.names = FALSE)
write.csv(SNP_pos, "../data/NAM_SNP_positions.csv", row.names = FALSE)
write.csv(SNP_pos, "../data/test_data/NAM_SNP_positions.csv", row.names = FALSE)
gen_map <- merge(NAM_map[,c("marker", "ch", "cumulative")],
SNP_pos[,c("Marker", "Position(bp)")], by.x = "marker", by.y = "Marker")
gen_map$Position <- as.numeric(gen_map$Position)
#sort by chr then position
gen_map <- gen_map[order(gen_map$ch, gen_map$Position),]
gen_map <- data.table(gen_map)
gen_map[, order := ((shift(cumulative, n = -1) - cumulative) >= 0), by = ch]
#manually remove "misplaced SNPs"
gen_map <- gen_map[!(marker %in% c("PZA01072.1", "PZA00545.26", "PZA00963.3", "PZA01960.1",
"zb7.2", "PHM1184.26", "PHM2438.28", "PZA03227.1"))]
#remove SNPs where cumulative cM order != SNP position order
gen_map <- gen_map[order == TRUE]
#(i+1-i)/(j+1-j) where i is cM and j is Mb, transform to Mb, group by chr
gen_map[, pos_diff := (shift(Position, n = -1) - Position), by = ch]
gen_map[, cM_diff := (shift(cumulative, n = -1) - cumulative), by = ch]
gen_map[, rate := cM_diff/(pos_diff/1000000)]
#impute rates for last SNPs per chr
gen_map[,rate := replace(rate, is.na(rate), median(rate, na.rm = TRUE)), by = ch]
gen_map <- gen_map[,c("ch", "Position", "rate", "cumulative")]
colnames(gen_map) <- c("Chromosome", "Position(bp)", "Rate(cM/Mb)", "Map(cM)")
#gen_map$Chromosome <- as.character(gen_map$Chromosome)
#gen_map$Chromosome <- paste("chr", gen_map$Chromosome, sep = "")
#save chr1 and complete set
genmap_chr1 <- gen_map[Chromosome == "chr1"]
write.csv(genmap_chr1, "../data/test_data/B73_genmap_chr1.csv", row.names = FALSE)
write.csv(gen_map, "../data/test_data/B73_genmap.csv", row.names = FALSE)
#save chr1 and complete set
genmap_chr1 <- gen_map[Chromosome == 1]
write.csv(genmap_chr1, "../data/test_data/B73_genmap_chr1.csv", row.names = FALSE)
write.csv(gen_map, "../data/test_data/B73_genmap.csv", row.names = FALSE)
View(genmap_chr1)
genmap_chr1[order(genmap_chr1$`Position(bp)`),]
genmap_chr1[order(genmap_chr1$`Position(bp)`),] -> test
View(test)
#genotpyes
#reduce nam offspring genotypes to subset
#load NAM genos imputed
offspring_genos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_genos_imputed_20090807.xlsx")
View(offspring_genos)
#get pop 1 genotypes
pop_1_genos <- offspring_genos[c(3:196),]
View(pop_1_genos)
colnames(pop_1_genos) <- offspring_genos[2,]
write.csv(pop_1_genos, "../data/test_data/pop_1_genos.csv", row.names = FALSE)
#turn A/A encoding to 0,1,2 of nam snp genos raw
NAM_genos <- read.table("../data/NAM_map_and_genos-121025/NAM_SNP_genos_raw_20090921.txt", header = TRUE,
row.names = 1)
View(NAM_genos)
#only parent genos
NAM_genos <- NAM_genos[,c(1:27)]
#only parent genos
NAM_parent_genos <- t(NAM_genos[,c(1:27)])
t(NAM_genos)
View(NAM_parent_genos)
write.csv(NAM_parent_genos, "../data/test_data/NAM_parent_genos.csv", row.names = FALSE)
write.csv(NAM_parent_genos, "../data/test_data/NAM_parent_genos.csv")
#turn A/A encoding to 0,1,2 of nam snp genos raw
NAM_genos <- read.table("../data/NAM_map_and_genos-121025/NAM_SNP_genos_raw_20090921.txt", header = TRUE)
View(NAM_genos)
#only parent genos
NAM_parent_genos <- t(NAM_genos[,c(1:27)])
View(NAM_parent_genos)
#turn A/A encoding to 0,1,2 of nam snp genos raw
NAM_genos <- read.table("../data/NAM_map_and_genos-121025/NAM_SNP_genos_raw_20090921.txt", header = TRUE,
row.names = 1)
View(NAM_genos)
#turn A/A encoding to 0,1,2 of nam snp genos raw
NAM_genos <- read.table("../data/NAM_map_and_genos-121025/NAM_SNP_genos_raw_20090921.txt",
row.names = 1)
View(NAM_map)
View(NAM_genos)
#only parent genos
NAM_parent_genos <- t(NAM_genos[,c(1:27)])
View(NAM_parent_genos)
colnames(NAM_parent_genos)[1] <- "RIL"
write.csv(NAM_parent_genos, "../data/test_data/NAM_parent_genos.csv")
write.csv(NAM_parent_genos, "../data/test_data/NAM_parent_genos.csv")
write.csv(NAM_parent_genos, "../data/test_data/NAM_parent_genos.csv", row.names = FALSE)
library(adegenet)
data(microsatt)
x <- as.genpop(microsatt$tab)
#allele counts
x@tab
#calculate allele frequencies
X <- makefreq(x, missing = "mean", quiet = TRUE)
X
x <- matrix(c(0,1,2,1,1,2,0,0,0,0,1,1), nrow = 3)
View(x)
x <- matrix(c(0,1,0,1,2,0,2,0,1,1,0,1), nrow = 3)
source("C:/Users/PHLUP/Masterarbeit/R_scripts/genetic_dist.R")
x <- matrix(c(0,1,0,1,2,0,2,0,1,1,0,1), nrow = 3)
View(x)
makefreq(x)
calculate_snp_frequency <- function(matrix) {
num_individuals <- nrow(matrix)
num_snps <- ncol(matrix)
snp_frequencies <- matrix(0, nrow = num_snps, ncol = 3)
for (j in 1:num_snps) {
snp_counts <- table(matrix[, j])
if (0 %in% names(snp_counts)) {
snp_count_0 <- snp_counts[["0"]]
} else {
snp_count_0 <- 0
}
if (1 %in% names(snp_counts)) {
snp_count_1 <- snp_counts[["1"]]
} else {
snp_count_1 <- 0
}
if (2 %in% names(snp_counts)) {
snp_count_2 <- snp_counts[["2"]]
} else {
snp_count_2 <- 0
}
snp_frequency_0 <- snp_count_0 / num_individuals
snp_frequency_1 <- snp_count_1 / num_individuals
snp_frequency_2 <- snp_count_2 / num_individuals
snp_frequencies[j, ] <- c(snp_frequency_0, snp_frequency_1, snp_frequency_2)
}
return(snp_frequencies)
}
x@tab
x <- as.genpop(microsatt$tab)
x@tab
as.matrix(x@tab)
calculate_snp_frequency(as.matrix(x@tab))
example_matrix <- matrix(c(0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1), nrow = 3, ncol = 4, byrow = TRUE)
snp_frequencies <- calculate_snp_frequency(example_matrix)
print(snp_frequencies)
View(example_matrix)
library(openxlsx)
library(data.table)
#calculate recombination rates (cM/Mb) for Maize NAM population (B73)
#read in cM and chr SNP data
NAM_map <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_map_20080419_xlsx.xlsx")
SNP_pos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_1144SNPs_AGPv1_positions.xlsx")
SNP_pos <- SNP_pos[!((SNP_pos$Position == "NULL") | (SNP_pos$Position == "multiple")),]
#save SNP positions
SNP_pos <- SNP_pos[,c("Marker", "Chr", "Position")]
colnames(SNP_pos) <- c("Marker", "Chromosome", "Position(bp)")
write.csv(SNP_pos, "../data/test_data/NAM_SNP_positions.csv", row.names = FALSE)
#merge on SNP id
gen_map <- merge(NAM_map[,c("marker", "ch", "cumulative")],
SNP_pos[,c("Marker", "Position(bp)")], by.x = "marker", by.y = "Marker")
gen_map$Position <- as.numeric(gen_map$Position)
#sort by chr then position
gen_map <- gen_map[order(gen_map$ch, gen_map$Position),]
gen_map <- data.table(gen_map)
gen_map[, order := ((shift(cumulative, n = -1) - cumulative) >= 0), by = ch]
#manually remove "misplaced SNPs"
gen_map <- gen_map[!(marker %in% c("PZA01072.1", "PZA00545.26", "PZA00963.3", "PZA01960.1",
"zb7.2", "PHM1184.26", "PHM2438.28", "PZA03227.1"))]
#remove SNPs where cumulative cM order != SNP position order
gen_map <- gen_map[order == TRUE]
#(i+1-i)/(j+1-j) where i is cM and j is Mb, transform to Mb, group by chr
gen_map[, pos_diff := (shift(Position, n = -1) - Position), by = ch]
gen_map[, cM_diff := (shift(cumulative, n = -1) - cumulative), by = ch]
gen_map[, rate := cM_diff/(pos_diff/1000000)]
#impute rates for last SNPs per chr
gen_map[,rate := replace(rate, is.na(rate), median(rate, na.rm = TRUE)), by = ch]
View(gen_map)
gen_map <- gen_map[,c("marker","ch", "Position", "rate", "cumulative")]
colnames(gen_map) <- c("Marker", "Chromosome", "Position(bp)", "Rate(cM/Mb)", "Map(cM)")
#save chr1 and complete set
genmap_chr1 <- gen_map[Chromosome == 1]
write.csv(genmap_chr1, "../data/test_data/B73_genmap_chr1.csv", row.names = FALSE)
write.csv(gen_map, "../data/test_data/B73_genmap.csv", row.names = FALSE)
#genotpyes
#reduce nam offspring genotypes to subset
#load NAM genos imputed
offspring_genos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_genos_imputed_20090807.xlsx")
View(offspring_genos)
#get pop 1 genotypes
pop_1_genos <- offspring_genos[c(3:196),]
colnames(pop_1_genos) <- offspring_genos[2,]
View(pop_1_genos)
length(pop_1_genos)
length(pop_1_genos[,1])
pop_1_genos[,c(2:1107)] <- sapply(pop_1_genos[,c(2:1107)], as.numeric)
pop_1_genos[pop_1_genos == 1.5] <- 1.0
pop_1_genos[pop_1_genos == 0.5] <- 1.0
write.csv(pop_1_genos, "../data/test_data/pop_1_genos.csv", row.names = FALSE)
library(openxlsx)
library(data.table)
#calculate recombination rates (cM/Mb) for Maize NAM population (B73)
#read in cM and chr SNP data
NAM_map <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_map_20080419_xlsx.xlsx")
SNP_pos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_1144SNPs_AGPv1_positions.xlsx")
SNP_pos <- SNP_pos[!((SNP_pos$Position == "NULL") | (SNP_pos$Position == "multiple")),]
#save SNP positions
SNP_pos <- SNP_pos[,c("Marker", "Chr", "Position")]
colnames(SNP_pos) <- c("Marker", "Chromosome", "Position(bp)")
write.csv(SNP_pos, "../data/test_data/NAM_SNP_positions.csv", row.names = FALSE)
#merge on SNP id
gen_map <- merge(NAM_map[,c("marker", "ch", "cumulative")],
SNP_pos[,c("Marker", "Position(bp)")], by.x = "marker", by.y = "Marker")
gen_map$Position <- as.numeric(gen_map$Position)
#sort by chr then position
gen_map <- gen_map[order(gen_map$ch, gen_map$Position),]
gen_map <- data.table(gen_map)
gen_map[, order := ((shift(cumulative, n = -1) - cumulative) >= 0), by = ch]
View(gen_map)
gen_map[, pos_diff := (shift(Position, n = -1) - Position), by = ch]
gen_map[, cM_diff := (shift(cumulative, n = -1) - cumulative), by = ch]
gen_map[, rate := cM_diff/(pos_diff/1000000)]
View(gen_map)
NAM_map <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_map_20080419_xlsx.xlsx")
SNP_pos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_1144SNPs_AGPv1_positions.xlsx")
SNP_pos <- SNP_pos[!((SNP_pos$Position == "NULL") | (SNP_pos$Position == "multiple")),]
#save SNP positions
SNP_pos <- SNP_pos[,c("Marker", "Chr", "Position")]
colnames(SNP_pos) <- c("Marker", "Chromosome", "Position(bp)")
write.csv(SNP_pos, "../data/test_data/NAM_SNP_positions.csv", row.names = FALSE)
#merge on SNP id
gen_map <- merge(NAM_map[,c("marker", "ch", "cumulative")],
SNP_pos[,c("Marker", "Position(bp)")], by.x = "marker", by.y = "Marker")
gen_map$Position <- as.numeric(gen_map$Position)
#sort by chr then position
gen_map <- gen_map[order(gen_map$ch, gen_map$Position),]
gen_map <- data.table(gen_map)
gen_map[, order := ((shift(cumulative, n = -1) - cumulative) >= 0), by = ch]
#manually remove "misplaced SNPs"
gen_map <- gen_map[!(marker %in% c("PZA01072.1", "PZA00545.26", "PZA00963.3", "PZA01960.1",
"zb7.2", "PHM1184.26", "PHM2438.28", "PZA03227.1"))]
#remove SNPs where cumulative cM order != SNP position order
gen_map <- gen_map[order == TRUE]
#(i+1-i)/(j+1-j) where i is cM and j is Mb, transform to Mb, group by chr
gen_map[, pos_diff := (shift(Position, n = -1) - Position), by = ch]
gen_map[, cM_diff := (shift(cumulative, n = -1) - cumulative), by = ch]
gen_map[, rate := cM_diff/(pos_diff/1000000)]
View(gen_map)
NAM_map <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_map_20080419_xlsx.xlsx")
SNP_pos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_1144SNPs_AGPv1_positions.xlsx")
SNP_pos <- SNP_pos[!((SNP_pos$Position == "NULL") | (SNP_pos$Position == "multiple")),]
#save SNP positions
SNP_pos <- SNP_pos[,c("Marker", "Chr", "Position")]
colnames(SNP_pos) <- c("Marker", "Chromosome", "Position(bp)")
write.csv(SNP_pos, "../data/test_data/NAM_SNP_positions.csv", row.names = FALSE)
#merge on SNP id
gen_map <- merge(NAM_map[,c("marker", "ch", "cumulative")],
SNP_pos[,c("Marker", "Position(bp)")], by.x = "marker", by.y = "Marker")
gen_map$Position <- as.numeric(gen_map$Position)
#sort by chr then position
gen_map <- gen_map[order(gen_map$ch, gen_map$Position),]
gen_map <- data.table(gen_map)
gen_map[, order := ((shift(cumulative, n = -1) - cumulative) >= 0), by = ch]
#manually remove "misplaced SNPs"
gen_map <- gen_map[!(marker %in% c("PZA01072.1", "PZA00545.26", "PZA00963.3", "PZA01960.1",
"zb7.2", "PHM1184.26", "PHM2438.28", "PZA03227.1"))]
#remove SNPs where cumulative cM order != SNP position order
gen_map <- gen_map[order == TRUE]
NAM_map <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_map_20080419_xlsx.xlsx")
SNP_pos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_1144SNPs_AGPv1_positions.xlsx")
SNP_pos <- SNP_pos[!((SNP_pos$Position == "NULL") | (SNP_pos$Position == "multiple")),]
#save SNP positions
SNP_pos <- SNP_pos[,c("Marker", "Chr", "Position")]
colnames(SNP_pos) <- c("Marker", "Chromosome", "Position(bp)")
write.csv(SNP_pos, "../data/test_data/NAM_SNP_positions.csv", row.names = FALSE)
#merge on SNP id
gen_map <- merge(NAM_map[,c("marker", "ch", "cumulative")],
SNP_pos[,c("Marker", "Position(bp)")], by.x = "marker", by.y = "Marker")
gen_map$Position <- as.numeric(gen_map$Position)
#sort by chr then position
gen_map <- gen_map[order(gen_map$ch, gen_map$Position),]
gen_map <- data.table(gen_map)
gen_map[, order := ((shift(cumulative, n = -1) - cumulative) >= 0), by = ch]
#manually remove "misplaced SNPs"
gen_map <- gen_map[!(marker %in% c("PZA01072.1", "PZA00545.26", "PZA00963.3", "PZA01960.1",
"zb7.2", "PHM1184.26", "PHM2438.28", "PZA03227.1"))]
#remove SNPs where cumulative cM order != SNP position order
gen_map <- gen_map[order == TRUE]
#(i+1-i)/(j+1-j) where i is cM and j is Mb, transform to Mb, group by chr
gen_map[, pos_diff := (shift(Position, n = -1) - Position), by = ch]
gen_map[, cM_diff := (shift(cumulative, n = -1) - cumulative), by = ch]
gen_map[, rate := cM_diff/(pos_diff/1000000)]
#impute rates for last SNPs per chr
gen_map[,rate := replace(rate, is.na(rate), median(rate, na.rm = TRUE)), by = ch]
gen_map <- gen_map[,c("marker","ch", "Position", "rate", "cumulative")]
colnames(gen_map) <- c("Marker", "Chromosome", "Position(bp)", "Rate(cM/Mb)", "Map(cM)")
#read NAM genos extract parents and b73 allele
NAM_genos <- read.table("../data/NAM_map_and_genos-121025/NAM_SNP_genos_raw_20090921.txt",
row.names = 1)
#only parent genos
NAM_parent_genos <- t(NAM_genos[,c(1:27)])
colnames(NAM_parent_genos)[1] <- "RIL"
View(NAM_genos)
#B73 allele
B73_allele <- data.table("SNP" = row.names(NAM_genos), "B73" = substring(NAM_genos[,1], 1, 1))
library(data.table)
#B73 allele
B73_allele <- data.table("SNP" = row.names(NAM_genos), "B73" = substring(NAM_genos[,1], 1, 1))
View(B73_allele)
#read NAM genos extract parents and b73 allele
NAM_genos <- read.table("../data/NAM_map_and_genos-121025/NAM_SNP_genos_raw_20090921.txt",
row.names = 1)
#only parent genos
NAM_parent_genos <- t(NAM_genos[,c(1:27)])
View(NAM_parent_genos)
colnames(NAM_parent_genos)[1] <- "RIL"
#B73 allele
B73_allele <- data.table("SNP" = row.names(NAM_genos), "B73" = substring(NAM_genos[,1], 1, 1))
View(B73_allele)
write.csv(B73_allele, "../data/test_data/B73_allelestest.csv", row.names = FALSE)
View(NAM_parent_genos)
B73_allele[-1]
#B73 allele
B73_allele <- data.table("SNP" = row.names(NAM_genos), "B73" = c(substring(NAM_genos[,1], 1, 1), substring(NAM_genos[,1], 3, 3)))
#B73 allele
B73_allele <- data.table("SNP" = row.names(NAM_genos), "B73" = paste(substring(NAM_genos[,1], 1, 1), substring(NAM_genos[,1], 3, 3)))
View(B73_allele)
#B73 allele
B73_allele <- data.table("SNP" = row.names(NAM_genos), "B73" = paste(substring(NAM_genos[,1], 1, 1), substring(NAM_genos[,1], 3, 3),
sep = ""))
View(B73_allele)
write.csv(B73_allele[-1], "../data/test_data/B73_allelestest.csv", row.names = FALSE)
write.csv(B73_allele[-1], "../data/test_data/B73_alleles.csv", row.names = FALSE)
table(B73_allele$B73)
View(NAM_genos)
library(openxlsx)
library(data.table)
#genotpyes
#reduce nam offspring genotypes to subset
#load NAM genos imputed
offspring_genos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_genos_imputed_20090807.xlsx")
#get pop 1 genotypes
pop_1_genos <- offspring_genos[c(3:196),]
colnames(pop_1_genos) <- offspring_genos[2,]
pop_1_genos[,c(2:1107)] <- sapply(pop_1_genos[,c(2:1107)], as.numeric)
View(pop_1_genos)
write.csv(pop_1_genos, "../data/test_data/pop_1_genos.csv", row.names = FALSE)
View(pop_1_genos)
#genotpyes
#reduce nam offspring genotypes to subset
#load NAM genos imputed
offspring_genos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_genos_imputed_20090807.xlsx")
library(openxlsx)
library(data.table)
#genotpyes
#reduce nam offspring genotypes to subset
#load NAM genos imputed
offspring_genos <- read.xlsx("../data/NAM_map_and_genos-121025/NAM_genos_imputed_20090807.xlsx")
View(offspring_genos)
#get pop 2 genotypes
pop_2_genos <- offspring_genos[c(197:392),]
colnames(pop_2_genos) <- offspring_genos[2,]
View(pop_2_genos)
pop_2_genos[,c(2:1107)] <- sapply(pop_2_genos[,c(2:1107)], as.numeric)
write.csv(pop_2_genos, "../data/test_data/pop_2_genos.csv", row.names = FALSE)
#get pop 3 genotypes
pop_3_genos <- offspring_genos[c(393:582),]
colnames(pop_3_genos) <- offspring_genos[2,]
pop_3_genos[,c(2:1107)] <- sapply(pop_3_genos[,c(2:1107)], as.numeric)
write.csv(pop_3_genos, "../data/test_data/pop_3_genos.csv", row.names = FALSE)
View(offspring_genos)
View(NAM_genos)
